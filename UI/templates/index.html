<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta http-equiv="X-UA-Compatible" content="IE=edge" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <link rel="stylesheet" href="../static/styles/form.css" />
    <link rel="stylesheet" href="../static/styles/header.css" />
    <link rel="stylesheet" href="../static/styles/index.css" />
    <link rel="stylesheet" href="../static/styles/main.css" />
    <title>Index</title>
  </head>
  <body>
    <header class="header">
      <div class="wrapper">
        <nav class="nav">
          <div class="nav__left">
            <ul class="nav__items">
              <li class="nav__item"><a class="nav__link" href="/">Bank</a></li>
              {% if not session.user %}
              <li class="nav__item">
                <a class="nav__link" href="/login">Login</a>
              </li>
              <li class="nav__item">
                <a class="nav__link" href="/register">Register</a>
              </li>
              {% endif %}
            </ul>
          </div>
          <div class="nav__right">
            <ul class="nav__items">
              {% if session.user %}
              <li class="nav__item">
                <a class="nav__link" href="/profile"
                  >{{ user.name }} {{ user.lastname }}</a
                >
              </li>
              <li class="nav__item">
                <a class="nav__link" href="/logout">Logout</a>
              </li>
              {% endif %}
            </ul>
          </div>
        </nav>
      </div>
    </header>

    <section class="section">
      <div class="wrapper">
        <div class="headline">
          <h1 class="headline__h1">Welcome to the Bank</h1>
        </div>
      </div>
    </section>

    <!-- TODO: Check if card info is valid -->
    <section class="section">
      <div class="wrapper">
        <div class="main">
          <div class="left-div">
            {% if user.verified == 0 %}
            <div class="wrapper">
              <form
                class="form"
                action="http://127.0.0.1:5000/linkCard"
                method="POST"
              >
                <h1 class="section-headline">Link Card</h1>
                <table>
                  <tr>
                    <td>
                      <label for="cardNum" class="form__label"
                        >Card number</label
                      >
                    </td>
                    <td>
                      <input
                        class="form__input"
                        name="cardNum"
                        type="number"
                        required
                        min="1000000000000000"
                        min="9999999999999999"
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label for="owner" class="form__label">Owner</label>
                    </td>
                    <td>
                      <input
                        class="form__input"
                        name="owner"
                        type="text"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label for="date" class="form__label"
                        >Expiration Date</label
                      >
                    </td>
                    <td>
                      <input
                        class="form__input form__input--date"
                        name="month"
                        type="number"
                        max="12"
                        min="1"
                        required
                      />
                      <input
                        class="form__input form__input--date"
                        name="year"
                        type="number"
                        max="99"
                        min="1"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <td>
                      <label for="securityCode" class="form__label"
                        >Security Code</label
                      >
                    </td>
                    <td>
                      <input
                        class="form__input"
                        name="securityCode"
                        type="number"
                        max="999"
                        min="100"
                        required
                      />
                    </td>
                  </tr>
                  <tr>
                    <td class="button" colspan="2">
                      <input
                        class="form__input form__input--button"
                        type="submit"
                        value="Link card"
                      />
                    </td>
                  </tr>
                  {% if message %}
                  <tr>
                    <td colspan="2">{{ message }}</td>
                  </tr>
                  {% endif %}
                </table>
              </form>
            </div>
            {% endif %} {% if user.verified != 0 %}
            <div class="wrapper">
              <h1 class="section-headline">Card Information</h1>
              <table class="section__table">
                <tr>
                  <td>
                    <label for="cardNum" class="section__label"
                      >Card number:</label
                    >
                  </td>
                  <td>
                    <label for="cardNum" class="section__label"
                      >{{card.cardNum}}</label
                    >
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="owner" class="section__label">Owner:</label>
                  </td>
                  <td>
                    <label for="owner" class="section__label"
                      >{{card.owner}}</label
                    >
                  </td>
                </tr>
                <tr>
                  <td>
                    <label for="date" class="section__label"
                      >Expiration Date:</label
                    >
                  </td>
                  <td>
                    <label for="date" class="section__label"
                      >{{card.expDate}}</label
                    >
                  </td>
                </tr>
              </table>

              <br />

              <h1 class="section-headline">Balance Information</h1>
              <table>
                <tr>
                  <td>
                    <label class="section__label" for="balance"
                      >Currently Available Balance:</label
                    >
                  </td>
                  <td>
                    <label class="section__label" name="balance">
                      {{ user.balance }} {{ user.currency }}</label
                    >
                  </td>
                </tr>
              </table>
            </div>
            {% endif %}
          </div>

          {% if user.verified != 0 %}
          <div class="center-div">
            <!-- Adding funds to account -->
            <form action="http://127.0.0.1:5000/addFunds" method="POST">
              <table>
                <h1 class="section-headline">Add funds</h1>
                <tr>
                  <td>
                    <input
                      type="number"
                      min="1"
                      name="amount"
                      class="section__input"
                      placeholder="1"
                    />
                  </td>
                  <td style="position: relative;"><td style="position: absolute; left: 41%">RSD</td></td>
                </tr>
                <tr>
                  <td style="text-align: right;"><button class="button button-section" type="submit">ADD</button></td>
                </tr>
              </table>
            </form>

            <br />
            <br />
            <br />

            <div class="section__convert">
              <h1 class="section-headline">Convert your balance to:</h1>
              <div>
                <form action="http://127.0.0.1:5000/convert" method="POST">
                  <select class="exchange__input" style="width: 100px;" name="convertCurrency">
                    {% for currency in currency_dictionary %}
                      <option value="{{ currency }}">{{ currency }}</option>
                    {% endfor %}
                  </select>
                  <p> {{ user.balance }} {{ user.currency }} = {{ converted_balance }}</p>
                  <input type="submit" value="Convert"/>
                </form>
              </div>
            </div>
          </div>
          
          <div class="right-div">
            <form action="http://127.0.0.1:5000/initTransaction" method="POST">
              <table>
                <h1 class="section-headline">Transaction</h1>
                <tr>
                  <td>
                    <select class="section__input input-sm">
                      <option value="email">email</option>
                      <option value="accountNumber">account number</option>
                    </select>
                  </td>
                </tr>
                <tr>
                  <td><input placeholder="Receiver" class="section__input input-md" type="text" name="receiver" /></td>
                </tr>
                <tr class="test">
                  <td>
                    <label class="section__label">Amount: </label>
                  </td>
                  <td style="position: relative;">
                    <td style="position: absolute; left: 69%; padding-top: 5px;">
                      <input min="1" placeholder="1" class="section__input" type="text" name="amount" />
                      <select name="transactionCurrency">
                        {% for currency in currency_dictionary %}
                          <option value="{{ currency }}">{{ currency }}</option>
                        {% endfor %}
                      </select>
                    </td>
                  </td>
                </tr>
                <tr >
                  <td  colspan="1" style="text-align: left;"><button class="button button-section" type="submit">ADD</button></td>
                </tr>
              </table>
            </form>
            <div>
              <h1 class="section-headline">Transaction History</h1>
              <div class="section__transaction">
              <form action="http://127.0.0.1:5000/sortByDateAsc" method="GET">
              <button type="submit">Date ascending</button>
              </form>
              <form action="http://127.0.0.1:5000/sortByDateDesc" method="GET">
              <button type="submit">Date descending</button>
              </form>
            </form>
                <ul class="transaction">
                  {% for transaction in transaction_history %}
                    {% if transaction.sender == user.email %}
                      <li class="transaction-minus">
                        {{ transaction.date }} {{ transaction.sender }} {{ transaction.receiver }} {{ transaction.amount }} {{ transaction.currency }} {{ transaction.state }}
                      </li>
                      {% else %}
                      <li class="transaction-addition">
                        {{ transaction.date }} {{ transaction.sender }} {{ transaction.receiver }} {{ transaction.amount }} {{ transaction.currency }} {{ transaction.state }}
                      </li>
                    {% endif %}
                  {% endfor %}

                  
                </ul>
              </div>
            </div>
          </div>
          {% endif %}
        </div>
      </div>
    </section>
  </body>
</html>